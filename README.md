# aqa_v2_wifi

## Программа для управления подсветкой аквариума выполнена на stm32f103c8t6.
---
## Дополнительные аппаратные части:
* светодиодная лента ws2813 (pwm + dma)
* релейный модуль на 2 реле (вкл/выкл по заданному времени)
* esp01 для связи с устройством
* динамически настраиваемые таймеры (время + день недели)
* возможность ручного управления лентой (залить всю ленту произвольным цветом, выборочная подсветка светодиодов)
* сохранение и загрузка таймеров в файл
* сохранение и загрузка карт подсветки для ленты
* также присутствует файл CubeMX
* исходники для STM написаны в Keil v5
* исходники для приложения управления написаны на QT

---
## Перед сборкой
### esp01
* Настроить модуль с помощью переходника *usb<->ttl*
* В исходниках (файл *usart.c*) установить скорость и параметры работы uart
* При желании в файле *main.c* в строке *139* указать порт для прослушивания (по умолчанию установлен *5555*)
> Рекомендуется оставить получение адреса по DHCP и настроить на роутере выдачу фиксированного адреса для esp01


---
# Схема подключения
* Port A
  - Pin1       <-> сигнал на вход ленты
  - Pin9(TX)   <-> esp01 RX
  - Pin10(RX)  <-> esp01 TX
  - Pin12      <-> Модуль реле вход 0
  - Pin13      <-> Модуль реле вход 1

* Питание
  - Для питания контроллера и блока реле используется БП с USB выходом на 500мА
  - USB Выход с БП подключается на USB вход контроллера, а модуль реле берет питание с ножки +5В расположенной на контроллере
  - Минус у всех элементов соеденяется между собой

![Схема](https://raw.githubusercontent.com/Pichas/aqa_v2_wifi/master/aqa.png)